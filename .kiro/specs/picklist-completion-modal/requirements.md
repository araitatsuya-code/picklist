# Requirements Document

## Introduction

この機能は、ショッピングリスト内の全てのアイテムがピッキング（選択）完了した際に、完了モーダルを表示してユーザーがリストを完了状態にできるようにする機能です。ユーザーの買い物体験を向上させ、リストの完了を明確に示すことで、次の買い物への準備を促進します。

## Requirements

### Requirement 1

**User Story:** ユーザーとして、リスト内の全てのアイテムをピッキングした時に、完了モーダルが自動的に表示されることを望む。これにより、全てのアイテムを取得したことを明確に認識できる。

#### Acceptance Criteria

1. WHEN リスト内の全てのアイテムがピッキング済み状態になった THEN システムは完了モーダルを自動的に表示する SHALL
2. WHEN 完了モーダルが表示される THEN モーダルには「完了」ボタンと「キャンセル」ボタンが含まれる SHALL
3. WHEN 完了モーダルが表示される THEN モーダルには完了したアイテム数とリスト名が表示される SHALL

### Requirement 2

**User Story:** ユーザーとして、完了モーダルで「完了」ボタンを押すことで、リストを完了状態にしたい。これにより、買い物が終了したことを記録できる。

#### Acceptance Criteria

1. WHEN ユーザーが完了モーダルで「完了」ボタンをタップした THEN システムはリストを完了状態に変更する SHALL
2. WHEN リストが完了状態になった THEN システムは完了日時を記録する SHALL
3. WHEN リストが完了状態になった THEN システムはショッピング履歴にリストを追加する SHALL
4. WHEN リストが完了状態になった THEN システムはユーザーをメイン画面またはリスト一覧画面に遷移させる SHALL

### Requirement 3

**User Story:** ユーザーとして、完了モーダルで「キャンセル」ボタンを押すことで、リストの編集を続けたい。これにより、間違ってピッキングしたアイテムを修正できる。

#### Acceptance Criteria

1. WHEN ユーザーが完了モーダルで「キャンセル」ボタンをタップした THEN システムはモーダルを閉じる SHALL
2. WHEN 完了モーダルがキャンセルされた THEN システムはリストの状態を変更しない SHALL
3. WHEN 完了モーダルがキャンセルされた THEN ユーザーは引き続きリストの編集ができる SHALL

### Requirement 4

**User Story:** ユーザーとして、完了モーダルが表示されている間も、必要に応じてアイテムのピッキング状態を変更したい。これにより、最後の確認ができる。

#### Acceptance Criteria

1. WHEN 完了モーダルが表示されている AND ユーザーがアイテムのピッキング状態を変更した THEN システムはモーダルを自動的に閉じる SHALL
2. WHEN アイテムのピッキング状態が変更されてリストが未完了状態になった THEN システムは完了モーダルを表示しない SHALL
3. WHEN 完了モーダルが表示されている THEN ユーザーはモーダルの背景をタップしてもモーダルが閉じない SHALL

### Requirement 5

**User Story:** ユーザーとして、空のリストや全てのアイテムが削除されたリストでは完了モーダルが表示されないことを望む。これにより、意味のない完了操作を防げる。

#### Acceptance Criteria

1. WHEN リストにアイテムが存在しない THEN システムは完了モーダルを表示しない SHALL
2. WHEN リスト内の全てのアイテムが削除された THEN システムは完了モーダルを表示しない SHALL
3. WHEN リストに少なくとも1つのアイテムが存在し、全てがピッキング済み THEN システムは完了モーダルを表示する SHALL

### Requirement 6

**User Story:** ユーザーとして、一度完了モーダルが表示されたリストを再度開いた時に、完了モーダルが再表示されないことを望む。これにより、既に完了確認済みのリストで不要なモーダルが表示されることを防げる。

#### Acceptance Criteria

1. WHEN リストが全てピッキング済み状態になった THEN システムは完了モーダル表示フラグを設定する SHALL
2. WHEN 完了モーダル表示フラグが設定されているリスト THEN システムは完了モーダルを再表示しない SHALL
3. WHEN ユーザーがアイテムのピッキング状態を未完了に変更した THEN システムは完了モーダル表示フラグをリセットする SHALL
4. WHEN 完了モーダル表示フラグがリセットされ、再び全てのアイテムがピッキング済みになった THEN システムは完了モーダルを表示する SHALL