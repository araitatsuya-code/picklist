# Picklist アプリケーション開発ハンドオーバー

## 1. これまでの実装状況

### 完了した実装
1. プロジェクトの初期設定
   - ESLint, TypeScript設定
   - ディレクトリ構造の作成
   - CI/CD設定

2. Expo Router導入
   - 基本的なルーティング構造の実装
   - app/_layout.tsx, index.tsx, scanner.tsx, settings.tsxの作成

3. 買い物リスト機能（feature/shopping-list）
   - Zustandによる状態管理
   - AsyncStorageによる永続化
   - リストのCRUD操作
   - ドラッグ&ドロップによる並び替え
   - アニメーション実装

4. よく買う商品リスト機能（feature/frequent-products）
   - 事前登録できる商品の管理
     - 商品名・バーコード・画像URL など
     - AsyncStorageでのデータ永続化
   - 買い物リストへの取り込み機能
     - 事前登録した商品を選択し、数量などを編集して追加

### 現在のブランチ状態
- main: よく買う商品リスト機能まで実装・マージ済み
- develop: よく買う商品リスト機能まで実装・マージ済み

## 2. 次の実装ステップ

### 優先順位順の実装予定
1. ソート表示機能（feature/sort-products）
   - UI/UX
     - 検索・フィルタ機能

2. 多言語対応（feature/add-i18n）
   - i18n-js導入
   - 日本語・英語対応
   - 言語切り替え機能

3. シェア機能（feature/share-function）
   - テキスト形式での出力
   - 外部アプリ連携

5. バーコードスキャン機能（feature/barcode-scanner）
   - ML Kit Barcode Scanning 実装
     - @react-native-firebase/ml の導入
     - 画像キャプチャによるバーコード解析
     - パーミッション管理の実装（カメラアクセスが必要な場合）

   - インラインスキャナーの実装
     - BottomSheetによるスキャナービューの表示
     - 撮影後の画像解析ワークフロー
     - アニメーションとトランジション
   
   - バーコード照合システム
     - Zustandストアでのバーコード管理
     - 既存アイテムとの照合ロジック
     - 照合結果に基づく自動チェック機能
   
   - 商品情報管理
     - 画像選択・プレビューコンポーネント
     - バーコード手動登録インターフェース
     - AsyncStorageでの画像データ永続化


## 3. 実装上の注意点

### バーコードスキャン機能
1. バーコードスキャンのワークフロー
   - 画像キャプチャ後に ML Kit で解析
   - 撮影ボタン UI の調整
   - メモリリーク防止のためのクリーンアップ

2. バーコードデータ管理
   - ML Kit を利用したバーコード情報の正規化
   - 撮影した画像を ML Kit で解析（リアルタイム処理ではなくバッチ処理）
   - 重複スキャン防止（一定時間内の同じバーコードを無視）
   - 履歴データの最適化

3. 画像管理
   - 画像サイズの最適化
   - Base64エンコーディングの効率化
   - ストレージ容量の考慮

## 4. 既知の課題・TODO

1. パフォーマンス最適化
   - 大量のアイテムがある場合のスクロールパフォーマンス
   - アニメーションの最適化

2. エラーハンドリング
   - ネットワークエラー対応
   - 永続化失敗時の対応

3. UI/UX改善
   - ダークモード対応
   - アクセシビリティ対応
   - ローディング状態の表示

## 5. 参考ドキュメント
- 仕様書: `/docs/SPECIFICATIONS.md`
- README: `/README.md`
- 進捗管理: `/docs/handover.md`

## 6. 開発環境
- Node.js: v18.x
- Expo SDK: 50.x
- React Native: 0.73.x
- TypeScript: 5.x
- Jest: 29.x
- @react-native-firebase/ml: ^17.x

## 7. テスト環境

### Jest設定
1. 基本設定
   - preset: jest-expo
   - テストファイル: `*.test.ts(x)`, `*.spec.ts(x)`
   - セットアップファイル: `jest.setup.js`

2. モック
   - AsyncStorage: 永続化のテストで使用
   - 他のネイティブモジュールは必要に応じて追加

3. テスト作成のルール
   - ストアのテスト: テスト用の簡易ストアを作成
   - コンポーネントのテスト: @testing-library/react-nativeを使用
   - スナップショットテスト: UIの変更を追跡

4. テストコマンド
   ```bash
   # 全テストを実行
   yarn test

   # ウォッチモードで実行
   yarn test:watch
   ```

## 8. 注意点
1. Tailwind CSSは採用を見送り
2. 標準のStyleSheetを使用
3. コンポーネントは`/src/components`に配置
4. ページコンポーネントは`/app`ディレクトリに配置
5. アニメーション実装時は必ずパフォーマンステストを実施

## 9. 次の開発者への要望
1. 各機能はfeatureブランチで開発
2. コミットメッセージは conventional commits に従う
3. PRはレビュー後にマージ
4. 仕様書と進捗管理ファイルの更新を忘れずに
5. 新機能実装時は必ずテストを追加

# Picklist アプリケーション仕様書

## 1. 実装済み機能

### 1.1 買い物リスト機能
1. リストのCRUD操作
   - リストの作成・編集・削除
   - アイテムの追加・編集・削除
   - 完了状態の管理

2. アイテムの並び替え機能
   - カテゴリー順（昇順/降順）
   - 名前順（昇順/降順）
   - 作成順（昇順/降順）
   - カテゴリーごとのグループ化表示

3. クイックアド機能
   - テキスト入力による素早いアイテム追加
   - よく買う商品との自動マッチング
   - カテゴリーの自動設定

### 1.2 よく買う商品機能
1. 商品管理
   - 商品の登録・編集・削除
   - カテゴリー設定
   - 画像管理

2. カテゴリー管理
   - カテゴリーの作成・編集・削除
   - 表示順の設定
   - 優先度の設定

## 2. データ構造

### 2.1 買い物リスト（Picklist）
```typescript
interface Picklist {
  id: string;
  name: string;
  items: PicklistItem[];
  sortBy?: 'created' | 'name' | 'category' | 'priority';
  sortDirection?: 'asc' | 'desc';
  groupByCategory?: boolean;
  createdAt: string;
  updatedAt: string;
}
```

### 2.2 リストアイテム（PicklistItem）
```typescript
interface PicklistItem {
  id: string;
  productId: string;
  name: string;
  quantity: number;
  unit?: string;
  category?: string;
  priority?: number;
  completed: boolean;
  maxPrice?: number;
  note?: string;
}
```

### 2.3 カテゴリー（Category）
```typescript
interface Category {
  id: string;
  name: string;
  displayOrder: number;
  priority: number;
}
```

## 3. 並び替え機能の仕様

### 3.1 並び替えオプション
1. カテゴリー順
   - カテゴリーの`displayOrder`に基づいて並び替え
   - カテゴリー内のアイテムは名前順

2. 名前順
   - アイテム名の文字列比較による並び替え
   - 大文字小文字を区別しない

3. 作成順
   - アイテムの追加順による並び替え
   - 最新のアイテムを上/下に表示可能

### 3.2 グループ化表示
- カテゴリーごとにアイテムをグループ化
- カテゴリーなしのアイテムは「その他」グループに表示
- グループヘッダーにカテゴリー名を表示

### 3.3 ソート設定の保存
- リストごとに個別の並び替え設定を保存
- アプリ再起動後も設定を維持

## 4. UI/UX仕様

### 4.1 リスト画面
1. ヘッダー
   - リスト名の表示・編集
   - 並び替えメニューボタン
   - リスト削除ボタン

2. クイックアド
   - テキスト入力フィールド
   - エンターキーで追加

3. アイテムリスト
   - チェックボックスで完了状態を切り替え
   - 完了アイテムは取り消し線表示
   - スワイプで削除

### 4.2 並び替えメニュー
1. メニュー項目
   - 作成順（昇順）
   - 作成順（降順）
   - 名前順（昇順）
   - 名前順（降順）
   - カテゴリー順（昇順）
   - カテゴリー順（降順）

## 5. 今後の改善点

### 5.1 機能拡張
1. 優先度による並び替え
2. カスタム並び替え順の保存
3. ドラッグ&ドロップによる手動並び替え
4. カテゴリーの色分け表示

### 5.2 パフォーマンス
1. 大量アイテム時の表示最適化
2. 並び替え処理の効率化
3. アニメーションの最適化
