# Picklist アプリケーション開発ハンドオーバー

## 1. これまでの実装状況

### 完了した実装
1. プロジェクトの初期設定
   - ESLint, TypeScript設定
   - ディレクトリ構造の作成
   - CI/CD設定

2. Expo Router導入
   - 基本的なルーティング構造の実装
   - app/_layout.tsx, index.tsx, scanner.tsx, settings.tsxの作成

3. 買い物リスト機能（feature/shopping-list）
   - Zustandによる状態管理
   - AsyncStorageによる永続化
   - リストのCRUD操作
   - ドラッグ&ドロップによる並び替え
   - アニメーション実装

4. よく買う商品リスト機能（feature/frequent-products）
   - 事前登録できる商品の管理
     - 商品名・バーコード・画像URL など
     - AsyncStorageでのデータ永続化
   - 買い物リストへの取り込み機能
     - 事前登録した商品を選択し、数量などを編集して追加

### 現在のブランチ状態
- main: よく買う商品リスト機能まで実装・マージ済み
- develop: よく買う商品リスト機能まで実装・マージ済み

## 2. 次の実装ステップ

### 優先順位順の実装予定
1. ソート表示機能（feature/sort-products）
   - UI/UX
     - 検索・フィルタ機能

2. 多言語対応（feature/add-i18n）
   - i18n-js導入
   - 日本語・英語対応
   - 言語切り替え機能

3. シェア機能（feature/share-function）
   - テキスト形式での出力
   - 外部アプリ連携

5. バーコードスキャン機能（feature/barcode-scanner）
   - ML Kit Barcode Scanning 実装
     - @react-native-firebase/ml の導入
     - 画像キャプチャによるバーコード解析
     - パーミッション管理の実装（カメラアクセスが必要な場合）

   - インラインスキャナーの実装
     - BottomSheetによるスキャナービューの表示
     - 撮影後の画像解析ワークフロー
     - アニメーションとトランジション
   
   - バーコード照合システム
     - Zustandストアでのバーコード管理
     - 既存アイテムとの照合ロジック
     - 照合結果に基づく自動チェック機能
   
   - 商品情報管理
     - 画像選択・プレビューコンポーネント
     - バーコード手動登録インターフェース
     - AsyncStorageでの画像データ永続化


## 3. 実装上の注意点

### バーコードスキャン機能
1. バーコードスキャンのワークフロー
   - 画像キャプチャ後に ML Kit で解析
   - 撮影ボタン UI の調整
   - メモリリーク防止のためのクリーンアップ

2. バーコードデータ管理
   - ML Kit を利用したバーコード情報の正規化
   - 撮影した画像を ML Kit で解析（リアルタイム処理ではなくバッチ処理）
   - 重複スキャン防止（一定時間内の同じバーコードを無視）
   - 履歴データの最適化

3. 画像管理
   - 画像サイズの最適化
   - Base64エンコーディングの効率化
   - ストレージ容量の考慮

## 4. 既知の課題・TODO

1. パフォーマンス最適化
   - 大量のアイテムがある場合のスクロールパフォーマンス
   - アニメーションの最適化

2. エラーハンドリング
   - ネットワークエラー対応
   - 永続化失敗時の対応

3. UI/UX改善
   - ダークモード対応
   - アクセシビリティ対応
   - ローディング状態の表示

## 5. 参考ドキュメント
- 仕様書: `/docs/SPECIFICATIONS.md`
- README: `/README.md`
- 進捗管理: `/docs/handover.md`

## 6. 開発環境
- Node.js: v18.x
- Expo SDK: 50.x
- React Native: 0.73.x
- TypeScript: 5.x
- Jest: 29.x
- @react-native-firebase/ml: ^17.x

## 7. テスト環境

### Jest設定
1. 基本設定
   - preset: jest-expo
   - テストファイル: `*.test.ts(x)`, `*.spec.ts(x)`
   - セットアップファイル: `jest.setup.js`

2. モック
   - AsyncStorage: 永続化のテストで使用
   - 他のネイティブモジュールは必要に応じて追加

3. テスト作成のルール
   - ストアのテスト: テスト用の簡易ストアを作成
   - コンポーネントのテスト: @testing-library/react-nativeを使用
   - スナップショットテスト: UIの変更を追跡

4. テストコマンド
   ```bash
   # 全テストを実行
   yarn test

   # ウォッチモードで実行
   yarn test:watch
   ```

## 8. 注意点
1. Tailwind CSSは採用を見送り
2. 標準のStyleSheetを使用
3. コンポーネントは`/src/components`に配置
4. ページコンポーネントは`/app`ディレクトリに配置
5. アニメーション実装時は必ずパフォーマンステストを実施

## 9. 次の開発者への要望
1. 各機能はfeatureブランチで開発
2. コミットメッセージは conventional commits に従う
3. PRはレビュー後にマージ
4. 仕様書と進捗管理ファイルの更新を忘れずに
5. 新機能実装時は必ずテストを追加
