# Picklist アプリケーション仕様書

## 1. システム概要
### 1.1 目的
効率的に買い物リストを作成・管理し、よく買う商品を登録して素早く買い物リストに追加できるモバイルアプリケーションを提供する。

### 1.2 対象ユーザー
- 買い物の計画を効率化したい一般ユーザー
- 家族や共同生活者間で買い物リストを共有したいユーザー
- よく購入する商品を効率的に管理したいユーザー

## 2. 機能仕様

### 2.1 買い物リスト機能
- 複数の買い物リストを作成・管理
- 各リストごとにアイテムの追加・編集・削除
- リスト名の編集
- リストの削除（確認ダイアログあり）
- アイテムの完了状態の管理（チェック機能）
- クイックアド機能による素早いアイテム追加
- アイテムの詳細編集機能（数量、価格上限、メモ）
- モーダルベースの編集UI

### 2.2 よく買う商品機能
- 頻繁に購入する商品を事前登録
- 登録商品の管理（追加・編集・削除）
- 商品情報の保存
  - 商品名
  - カテゴリー
  - 画像（任意）
  - 追加回数の記録
- 商品検索機能
- カテゴリーによるフィルタリング
- 複数商品の一括追加機能
- 商品一括選択モード
- 画像の自動エラー処理とクリーンアップ
- 商品使用頻度の自動追跡

### 2.3 並び替え・表示機能
- アイテムの並び替え
  - カテゴリー順（昇順/降順）
  - 名前順（昇順/降順）
  - 作成順（昇順/降順）
- カテゴリーごとのグループ化表示
- 並び替え設定のリストごとの保存

### 2.4 カテゴリー管理機能
- カテゴリーの作成・編集・削除
- カテゴリーの表示順の設定
- カテゴリーの優先度の設定
- カテゴリーに応じた商品の分類
- デフォルトカテゴリーの自動設定（野菜、魚・肉、日用品、飲料、その他）
- クイックアド時の自動カテゴリー推測

### 2.5 オンボーディング機能
- 初回起動時のチュートリアル
- 4画面構成（ウェルカム、買い物リスト、よく買う商品、カテゴリー）
- インタラクティブなページャー
- 完了状態の永続化

### 2.6 テーマ機能
- ライト/ダークモード対応
- システム設定への自動追従
- 全画面でのテーマ対応
- 統一されたデザインシステム

## 3. データ構造仕様

### 3.1 買い物リスト（Picklist）
```typescript
interface Picklist {
  id: string;
  name: string;
  items: PicklistItem[];
  sortBy?: 'created' | 'name' | 'category' | 'priority';
  sortDirection?: 'asc' | 'desc';
  groupByCategory?: boolean;
  createdAt: string;
  updatedAt: string;
}
```

### 3.2 リストアイテム（PicklistItem）
```typescript
interface PicklistItem {
  id: string;
  productId: string;
  name: string;
  quantity: number;
  unit?: string;
  category?: string;
  priority?: number;
  completed: boolean;
  maxPrice?: number;
  note?: string;
}
```

### 3.3 よく買う商品（FrequentProduct）
```typescript
interface FrequentProduct {
  id: string;
  name: string;
  category?: string;
  imageUrl?: string;
  barcode?: string;
  addCount: number;
}
```

### 3.4 カテゴリー（Category）
```typescript
interface Category {
  id: string;
  name: string;
  displayOrder: number;
  priority: number;
}
```

## 4. UI仕様

### 4.1 画面構成
- タブバーナビゲーション
  - 買い物リスト画面
  - よく買う商品画面
  - 設定画面
  - カテゴリー画面
- スタックナビゲーション
  - 商品追加画面
  - 商品編集画面
  - リスト詳細画面
- 初回起動時のオンボーディング画面
- テーマ対応のナビゲーション

### 4.2 買い物リスト画面
- リスト一覧表示
- 新規リスト作成ボタン
- リスト削除機能
- リスト名表示
- アイテム数表示

### 4.3 リスト詳細画面
- リスト名編集機能
- クイックアド入力フィールド
- アイテム一覧表示
- 完了チェック機能
- 並び替えメニュー
- カテゴリーごとのグループ表示
- アイテム削除機能
- アイテム編集機能（数量・メモ・価格上限の編集）
- バック機能（リスト一覧への戻るボタン）
- 商品画像の表示とモーダル拡大表示

### 4.4 よく買う商品画面
- 商品検索フィールド
- カテゴリーフィルター（水平スクロール）
- 商品追加ボタン
- 商品一覧表示
- 一括追加モード切替ボタン
- 選択した商品のリストへの一括追加機能

### 4.5 商品追加/編集画面
- 商品名入力
- カテゴリー選択
- 画像選択/表示
- 保存ボタン

## 5. 技術仕様

### 5.1 状態管理
- Zustandによる状態管理
  - usePicklistStore（買い物リスト管理）
  - useFrequentProductStore（よく買う商品管理）
  - useCategoryStore（カテゴリー管理）
  - useThemeStore（テーマ管理）
  - useOnboardingStore（オンボーディング管理）
- AsyncStorageによる永続化
- 商品画像のローカル保存
- 状態の検証とエラーハンドリング

### 5.2 UI実装
- React Native標準コンポーネント
- React Native Paperコンポーネント（一部使用）
- SafeAreaViewによる適切な画面表示
- カスタムコンポーネント
  - GroupedPicklistItems：カテゴリーごとのアイテム表示
  - ImagePicker：画像選択・表示コンポーネント
  - DraggableList：ドラッグ&ドロップ並び替えコンポーネント
  - ThemeProvider：テーマ管理コンポーネント
  - Onboarding：オンボーディング関連コンポーネント群

### 5.3 ナビゲーション
- Expo Router
  - タブナビゲーション
  - スタックナビゲーション
  - ディープリンク対応

### 5.4 デザインシステム
- テーマ対応
  - ライト/ダークモードの完全対応
  - システム設定への自動追従
  - 統一されたカラーパレット
- コンポーネントスタイル
  - 一貫したボタンスタイル
  - リスト表示の統一デザイン
  - 入力フォームの統一デザイン
  - プラットフォーム別のシャドウ効果

### 5.5 エラーハンドリング
- データ保存失敗時のフォールバック
- 画像読み込み失敗時のプレースホルダー表示
- 入力値の検証と適切なフィードバック
- 無効画像の自動削除とクリーンアップ
- 状態管理におけるエラー検証

### 5.6 画像管理
- Expo Image Picker：画像選択機能
- Expo Image Manipulator：画像リサイズ機能
- ローカルファイルシステム：画像保存・読み込み
- 自動エラー処理：無効画像の検出と削除
- モーダル表示：画像の拡大表示機能

## 6. 動作環境
- デバイス：iOS/Android
- 推奨バージョン：iOS 14以上、Android 8.0以上
- 推奨解像度：375x667以上（iPhone 8相当）
- オフライン対応：完全対応（すべての機能がインターネット接続なしで動作）
- React Native：0.76.9
- Expo：~52.0.46

## 7. バージョン情報
- 現在のバージョン：1.0.2
- 主要な更新内容：
  - バックボタンの追加とスタイル改善
  - ナビゲーションの改善（router.replaceの使用）
  - 商品編集機能の追加
